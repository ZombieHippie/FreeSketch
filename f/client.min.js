var $,Connection,Game,InputSlider,Listeners,Pencil,Toolbar,addPencil,appendSent,changePencil,checkUsername,client_id,closeInput,colorOutOfDate,connection,ctx,delay,drawData,drawSData,gameStarted,getConnection,getCookie,getId,getPencil,getUsername,gm,inputOpen,makeID,messageData,openInput,openNotice,pencilBox,pickupAPencil,removePencil,sendAndClear,serverMessage,setCookie,sizeOutOfDate,startGame,tools,uname,updateColor,updateSize,userConnection;$=Zepto;connection=0;ctx=0;gm=null;tools=null;gameStarted=false;inputOpen=false;sizeOutOfDate=false;colorOutOfDate=false;client_id=null;uname="";$(function(){var b,a;b="ws://70.94.89.253:236/";console.log("Creating new Socket at: "+b);a=new window.WebSocket(b);return connection=new Connection(a)});getConnection=function(){return connection};getUsername=function(){return uname};getId=function(){if(client_id===null){client_id=makeID()}return client_id};makeID=function(){var a,b;b="";a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";b+=a.charAt(Math.floor(Math.random()*a.length));b+=a.charAt(Math.floor(Math.random()*a.length));b+=a.charAt(Math.floor(Math.random()*a.length));return b};startGame=function(){var a,b,c;a=document.createElement("canvas");b=new Game(a);a.height=b.viewHeight;a.width=b.viewWidth;$(".g").text("");$(".g").append(a);b.run();c=new Listeners(b);gm=b;tools=new Toolbar(gm);return gameStarted=true};delay=function(b,a){return setTimeout(a,b)};updateColor=function(){tools.changeColor(tools.colorInput.getValue()/100,1,0.5);return colorOutOfDate=false};updateSize=function(){tools.changeSize(Math.floor(tools.sizeInput.getValue()/100*12));return sizeOutOfDate=false};openNotice=function(a){if(!inputOpen){openInput();inputOpen=true}if(a.keyCode===13){sendAndClear();return closeInput()}};openInput=function(){$("#largeInput").attr("style","visibility: visible;");$("#lightBox").attr("style","visibility: visible;");return $("#inputBox").focus()};closeInput=function(){$("#largeInput").attr("style","visibility: hidden;");$("#lightBox").attr("style","visibility: hidden;");if(colorOutOfDate){updateColor()}if(sizeOutOfDate){updateSize()}return inputOpen=false};sendAndClear=function(){if($("#inputBox").val()!==""){connection.sendMessage(getUsername(),$("#inputBox").val());appendSent($("#inputBox").val());return $("#inputBox").val("")}};Pencil=(function(){a.prototype.lastX=0;a.prototype.lastY=0;a.prototype.size=1;a.prototype.color="#000";a.prototype.drawing=false;function a(b){this.cid=b}return a})();pencilBox=[];addPencil=function(a){pencilBox.push(new Pencil(a));return getPencil(a)};removePencil=function(a){return delete getPencil(a)};getPencil=function(c){var d,a,b;for(a=0,b=pencilBox.length;a<b;a++){d=pencilBox[a];if(d.cid===c){return d}}return addPencil(c)};drawSData=function(b){var a,c,e,f;if(!gameStarted){return}a=b[0];e=b[1];f=b[2];c=getPencil(a);if(c===null||typeof c==="undefined"){return}if(!c.drawing){c.drawing=true}else{gm.drawIn(c.size,c.color,c.lastX,c.lastY,e,f)}c.lastX=e;return c.lastY=f};pickupAPencil=function(a){return getPencil(a).drawing=false};changePencil=function(b){var a,c,e,f;a=b[1];e=b[2];c=b[3];f=getPencil(a);f.size=e;return f.color=c};drawData=function(a){if(!gameStarted){return}return gm.drawIn(a[1],a[2],a[3],a[4])};serverMessage=function(a){return $("#messagelog").prepend('<li class="msg"><span style="color:#f3f">Server: </span>'+a[1].replace("`",":")+"</li>")};userConnection=function(a){$("#messagelog").prepend('<li class="msg"><span style="color:#4f4">Artist Joined: </span>'+a[1]+"</li>");return addPencil(a[2])};messageData=function(a){return $("#messagelog").prepend('<li class="msg"><span style="color:#f33">'+a[1]+": </span>"+a[2].replace("`",":")+"</li>")};appendSent=function(a){return $("#messagelog").prepend('<li class="msg"><span style="color:#33f">'+getUsername()+": </span>"+a+"</li>")};getCookie=function(d){var c,e,f,a,b;f=document.cookie.split(";");for(a=0,b=f.length;a<b;a++){c=f[a];e=c.split("=");console.log(e);if(e[0]===d){return unescape(e[1])}}return null};setCookie=function(b,c,e){var a,d;d=new Date();d.setDate(d.getDate()+e);a=escape(c)+(e===null?"":"; expires="+d.toUTCString());return document.cookie=b+"="+a};checkUsername=function(){var a;a=getCookie("username");if(a===null||a===""){a=prompt("Please enter your name:","");if(a!==null&&a!==""){setCookie("username",a,21)}}return uname=a};Game=(function(){a.prototype.viewWidth=720;a.prototype.viewHeight=720;a.prototype.positionX=0;a.prototype.positionY=0;a.prototype.pencilOutOfDate=false;a.prototype.uSize=1;a.prototype.uColor="#000";a.prototype.x1=0;a.prototype.y1=0;function a(b){this.canvas=b;this.ctx=this.canvas.getContext("2d");this.ctx.lineWidth=1;this.ctx.strokeStyle="#000";this.ctx.lineCap="round"}a.prototype.run=function(){this.ctx.fillStyle="#f2f2f2";this.ctx.fillRect(0,0,this.viewWidth,this.viewHeight);return this.ctx.lineCap="round"};a.prototype.position=function(){if(this.canvas&&!isNaN(this.canvas.offsetLeft)&&!isNaN(this.canvas.offsetTop)){this.positionX=this.canvas.offsetLeft-window.scrollX;return this.positionY=this.canvas.offsetTop-window.scrollY}};a.prototype.pickupPencil=function(){this.x1=0;this.y1=0;return getConnection().sendPickup()};a.prototype.draw=function(f,g){var b,c,d,e;b=this.x1;c=this.y1;d=Math.floor(f);e=Math.floor(g);this.x1=d;this.y1=e;this.ctx.lineWidth=this.uSize;this.ctx.strokeStyle=this.uColor;this.drawStep2(b,c,d,e);if(this.pencilOutOfDate){getConnection().sendPencil(this.uSize,this.uColor)}return getConnection().sendDraw(d,e)};a.prototype.drawIn=function(e,d,b,c,f,g){this.ctx.lineWidth=e;this.ctx.strokeStyle=d;return this.drawStep2(b,c,f,g)};a.prototype.drawStep2=function(b,c,d,e){if(b===0&&c===0){return}this.ctx.beginPath();this.ctx.moveTo(b,c);this.ctx.lineTo(d,e);return this.ctx.stroke()};return a})();Listeners=(function(){a.prototype.drawing=false;function a(c){var b=this;this.game=c;this.game.position();window.addEventListener("resize",function(){return b.game.position()});window.addEventListener("scroll",function(){return b.game.position()});this.game.canvas.addEventListener("mouseup",function(){return b.pickupPencil()});this.game.canvas.addEventListener("mousedown",function(){return b.drawing=true});this.game.canvas.addEventListener("mouseout",function(){return b.pickupPencil()});this.game.canvas.addEventListener("mousemove",function(d){var f,g;if(!b.drawing){return}f=d.clientX-b.game.positionX;g=d.clientY-b.game.positionY;return b.game.draw(f,g)})}a.prototype.pickupPencil=function(){this.drawing=false;return this.game.pickupPencil()};return a})();Connection=(function(){function a(b){this.wss=b;console.log("Connection initialized.");this.wss.onopen=function(){console.log("Connection opened, starting game.");startGame();return getConnection().Send("u:"+checkUsername()+":"+getId())};this.wss.onmessage=function(c){return getConnection().Receive(c)}}a.prototype.Receive=function(c){var b;b=c.data.split(":");if(b[0]==="b"){return changePencil(b)}if(b[0]==="p"){return pickupAPencil(b[1])}if(b[0]==="m"){return messageData(b)}if(b[0]==="s"){return serverMessage(b)}if(b[0]==="u"){return userConnection(b)}return drawSData(b)};a.prototype.Send=function(b){return this.wss.send(b)};a.prototype.sendDraw=function(c,d){var b;b="";b+=getId()+":"+c+":"+d;return this.Send(b)};a.prototype.sendPencil=function(c,b){return this.Send("b:"+getId()+":"+c+":"+b)};a.prototype.sendPickup=function(){return this.Send("p:"+getId())};a.prototype.sendMessage=function(b,c){var d;d="";d+="m:"+b.replace("`",":")+":"+c.replace("`",":");return this.Send(d)};return a})();Toolbar=(function(){function a(c){var b,d;this.game=c;b=$("#color").get(0);d=$("#size").get(0);this.colorInput=new InputSlider(b);this.sizeInput=new InputSlider(d)}a.prototype.changeSize=function(b){this.game.uSize=b;return this.game.pencilOutOfDate=true};a.prototype.changeColor=function(f,g,d){var e,i;e=this.hslToRgb(f,g,d);i="rgb("+Math.floor(e[0])+","+Math.floor(e[1])+","+Math.floor(e[2])+")";console.log(i);this.game.uColor=i;return this.game.pencilOutOfDate=true};a.prototype.hue2rgb=function(b,c,d){if(d<0){d+=1}if(d>1){d-=1}if(d<1/6){return b+(c-b)*6*d}if(d<1/2){return c}if(d<2/3){return b+(c-b)*(2/3-d)*6}return b};a.prototype.hslToRgb=function(e,m,f){var c,d,i,j,k;if(m===0){k=d=c=f}else{j=f<0.5?f*(1+m):f+m-f*m;i=2*f-j;k=this.hue2rgb(i,j,e+1/3);d=this.hue2rgb(i,j,e);c=this.hue2rgb(i,j,e-1/3)}return[k*255,d*255,c*255]};return a})();InputSlider=(function(){a.prototype.viewWidth=220;a.prototype.viewHeight=15;a.prototype.positionX=0;a.prototype.valueByWidth=50;a.prototype.choosing=false;a.prototype.outOfDate=false;a.prototype.offsetsLeft=function(b,c){if(!b){return c}c+=b.offsetLeft;return this.offsetsLeft(b.offsetParent,c)};function a(c){var b=this;this.canvas=c;console.log(this.canvas);this.position();this.ctx=this.canvas.getContext("2d");this.ctx.fillStyle="#000";this.canvas.addEventListener("mouseup",function(){return b.choosing=false});this.canvas.addEventListener("mousedown",function(){b.position();return b.choosing=true});this.canvas.addEventListener("mouseout",function(){return b.choosing=false});this.canvas.addEventListener("mousemove",function(d){if(!b.choosing){return}b.valueByWidth=d.clientX-b.positionX;return b.drawSlide()})}a.prototype.drawSlide=function(){console.log(this.canvas.width+"  "+this.valueByWidth);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);return this.ctx.fillRect(this.valueByWidth-1,0,2,this.canvas.height)};a.prototype.getValue=function(){return Math.floor(this.valueByWidth/220*100)};a.prototype.position=function(){console.log("offset: "+this.offsetsLeft(this.canvas,0));if(this.canvas&&!isNaN(this.canvas.offsetLeft)){return this.positionX=this.offsetsLeft(this.canvas,0)-window.scrollX}};return a})();